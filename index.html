<!DOCTYPE html>
<html lang="uk">

<head>
  <meta charset="UTF-8">
  <title>–ú–∞–≥—ñ—á–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ—Ä—Ç—Ä–µ—Ç–∞</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #fdf6f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 110vh;
      overflow: hidden;
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
    }

    button {
      margin-top: 25px;
      margin-bottom: 15px;
      padding: 27px 20px;
      font-size: 42px;
      background: linear-gradient(135deg, #ff7e5f, #feb47b);
      border: none;
      border-radius: 50px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s ease;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      z-index: 2;
    }

    button:hover {
      transform: scale(1.05);
    }

    canvas {
      margin-top: 20px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      background-color: #fff;
      opacity: 0;
      transition: opacity 1s ease;
    }

    .visible {
      opacity: 1;
    }

    #particles {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: 1;
      pointer-events: none;
    }
  </style>
</head>

<body>
  <button>‚ú® –ù–∞—Ç–∏—Å–Ω–∏ –Ω–∞ –º–µ–Ω–µ ‚ú®</button>
  <button onclick="startDrawing()">‚ú® –ê —Ç–µ–ø–µ—Ä –Ω–∞ –º–µ–Ω–µ ‚ú®</button>
  <canvas id="canvas" width="700" height="700"></canvas>
  <div id="particles"></div>

  <!-- üéµ –ê—É–¥—ñ–æ -->
  <audio id="bgMusic" src="./Mandy_Moore_-_Only_Hope.mp3" preload="auto"></audio>

  <script>
    const music = document.getElementById("bgMusic");
    music.volume = 0.3;
    let musicStarted = false;

    function startMusicOnce() {
      if (!musicStarted) {
        music.play().then(() => {
          setTimeout(() => {
            music.pause();
            music.currentTime = 0;
          }, 30000); // –ó—É–ø–∏–Ω–∏—Ç–∏ —á–µ—Ä–µ–∑ 20 —Å–µ–∫—É–Ω–¥
        }).catch(() => { /* –ë—Ä–∞—É–∑–µ—Ä –∑–∞–±–ª–æ–∫—É–≤–∞–≤ ‚Äì –Ω—ñ—á–æ–≥–æ –Ω–µ —Ä–æ–±–∏–º–æ */ });

        musicStarted = true;
        window.removeEventListener("click", startMusicOnce);
      }
    }

    // –ó–∞–ø—É—Å–∫–∞—î–º–æ –º—É–∑–∏–∫—É –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –∫–ª—ñ–∫—É
    window.addEventListener("click", startMusicOnce);

    // --- –ú–∞–ª—é–≤–∞–Ω–Ω—è ---
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const img = new Image();
    img.src = './photo_2025-05-22_19-34-44.jpg'; // –∑–∞–º—ñ–Ω–∏ –Ω–∞ —Å–≤—ñ–π —Ñ–∞–π–ª

    const step = 30;
    const positions = [];

    let drawOffsetX = 0;
    let drawOffsetY = 0;
    let scale = 1;

    img.onload = () => {
      const imgWidth = img.width;
      const imgHeight = img.height;

      const scaleX = canvas.width / imgWidth;
      const scaleY = canvas.height / imgHeight;
      scale = Math.min(scaleX, scaleY);

      const scaledWidth = imgWidth * scale;
      const scaledHeight = imgHeight * scale;

      drawOffsetX = (canvas.width - scaledWidth) / 2;
      drawOffsetY = (canvas.height - scaledHeight) / 2;

      for (let y = 0; y < imgHeight; y += step) {
        for (let x = 0; x < imgWidth; x += step) {
          positions.push({ x, y });
        }
      }

      shuffleArray(positions);
    };

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function startDrawing() {
      canvas.classList.add("visible");
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      shuffleArray(positions);

      let i = 0;
      const interval = setInterval(() => {
        if (i >= positions.length) {
          clearInterval(interval);
          triggerFireworks();
          return;
        }

        const pos = positions[i];
        const sx = pos.x;
        const sy = pos.y;
        const sWidth = step;
        const sHeight = step;
        const dx = drawOffsetX + pos.x * scale;
        const dy = drawOffsetY + pos.y * scale;
        const dWidth = step * scale;
        const dHeight = step * scale;

        ctx.drawImage(img, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);

        ctx.fillStyle = `rgba(255, 192, 203, 0.07)`;
        ctx.fillRect(dx, dy, dWidth, dHeight);

        i++;
      }, 10);
    }

    function triggerFireworks() {
      const container = document.getElementById('particles');
      for (let i = 0; i < 50; i++) {
        const particle = document.createElement('div');
        particle.style.position = 'absolute';
        particle.style.width = '10px';
        particle.style.height = '10px';
        particle.style.borderRadius = '50%';
        particle.style.background = randomColor();
        particle.style.left = Math.random() * window.innerWidth + 'px';
        particle.style.top = canvas.getBoundingClientRect().top + canvas.height / 2 + 'px';
        particle.style.opacity = '0.8';
        particle.style.transition = 'transform 1s ease-out, opacity 1.2s ease-out';
        container.appendChild(particle);

        requestAnimationFrame(() => {
          particle.style.transform = `translate(${(Math.random() - 0.5) * 600}px, ${-Math.random() * 500}px)`;
          particle.style.opacity = '0';
        });

        setTimeout(() => particle.remove(), 1500);
      }
    }

    function randomColor() {
      const colors = ['#ff7e5f', '#feb47b', '#f67280', '#c06c84', '#6c5b7b', '#355c7d'];
      return colors[Math.floor(Math.random() * colors.length)];
    }
  </script>

</body>

</html>